![](https://user-gold-cdn.xitu.io/2020/4/14/171783454e759a80?w=900&h=383&f=png&s=71447)

> æ ‘é…±å¸Œæœ›å°†å‰ç«¯çš„ä¹è¶£å¸¦ç»™å¤§å®¶
> æœ¬æ–‡å·²æ”¶å½• <a href="https://github.com/littleTreeme/frontendThings " style="word-wrap: break-word; font-weight: bold; border-bottom: 1px solid #1e6bb8; border: none; text-decoration: none; color: #dda52d;">https://github.com/littleTreeme/frontendThings</a> å–œæ¬¢å°±starâœ¨

> åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œç‰¹åˆ«æ˜¯ä¸­åå°ç®¡ç†é¡µé¢ï¼Œä¼šç»å¸¸ä½¿ç”¨åˆ°ä¸€äº›å¸¸ç”¨çš„å‡½æ•°æ¯”å¦‚ï¼šé˜²æŠ–èŠ‚æµã€æœ¬åœ°å­˜å‚¨ç›¸å…³ã€æ—¶é—´æ ¼å¼åŒ–ç­‰ï¼Œä½†æ˜¯éšç€é¡¹ç›®ä¸æ–­å¢åŠ ï¼Œå¤ç”¨æ€§å’Œé€šç”¨æ€§å°±æˆä¸ºä¸€ä¸ªå¾ˆè‡³å…³é‡è¦çš„é—®é¢˜ï¼Œå¦‚ä½•å‡å°‘å¤åˆ¶å¼ è´´çš„æ“ä½œï¼Œé‚£å°±æ˜¯å°è£…æˆä¸ºï¼Œé€‚ç”¨ä¸å¤šé¡¹ç›®ç»Ÿä¸€çš„å·¥å…·åŒ…ï¼Œå¹¶ç”¨npmè¿›è¡Œç®¡ç†ï¼Œâ€œUç›˜å¼å®‰è£…â€çš„æ–¹å¼å¯ä»¥æé«˜å›¢é˜Ÿçš„æ•ˆç‡ï¼Œé‚£ä»Šå¤©å°±è®²è®²å¼€å‘ä¸€ä¸ªç®€æ˜“çš„å·¥å…·åº“éœ€è¦æ¶‰åŠå“ªäº›ç¯èŠ‚ï¼Œçœ‹ä¸‹å›¾ğŸ‘‡





![](https://user-gold-cdn.xitu.io/2020/4/15/1717c90027fd7451?w=1582&h=760&f=png&s=61668)

### 1.é¡¹ç›®ç»“æ„

> å¼€å‘ä¸€ä¸ªå·¥å…·åº“ï¼Œåˆ°åº•éœ€è¦å“ªäº›é…ç½®ï¼Œä¸‹é¢æ˜¯æˆ‘å†™çš„ä¸€ä¸ªç®€æ˜“ç‰ˆå·¥å…·åº“ï¼ˆkdutilï¼‰çš„æ¡ˆä¾‹ğŸ‘‡



![](https://user-gold-cdn.xitu.io/2020/4/15/1717cd25f90d557c?w=836&h=1168&f=png&s=84303)

æ¶‰åŠåˆ°çš„æœ‰ï¼š

- build ï¼šç”¨æ¥å­˜æ”¾æ‰“åŒ…é…ç½®æ–‡ä»¶
- dist ï¼šç”¨æ¥å­˜æ”¾ç¼–è¯‘å®Œç”Ÿæˆçš„æ–‡ä»¶
- srcï¼š å­˜æ”¾æºä»£ç (åŒ…å«å„ä¸ªæ¨¡å—çš„å…¥å£åŠå¸¸é‡çš„å®šä¹‰)
- testï¼šå­˜æ”¾æµ‹è¯•ç”¨ä¾‹
- babel.config.js : é…ç½®å°†ES2015ç‰ˆæœ¬çš„ä»£ç è½¬æ¢ä¸ºå…¼å®¹çš„ JavaScript è¯­æ³•
- package.json : å®šä¹‰åŒ…çš„é…ç½®åŠä¾èµ–ä¿¡æ¯
- README.md ï¼šä»‹ç»äº†æ•´ä¸ªå·¥å…·åŒ…çš„ä½¿ç”¨åŠåŒ…å«çš„åŠŸèƒ½

### 2.æ‰“åŒ…æ–¹å¼
> ä¸ºä»€ä¹ˆéœ€è¦æ‰“åŒ…ï¼Ÿå·¥å…·åº“æ¶‰åŠåˆ°å¤šæ¨¡å—åŒ–å¼€å‘ï¼Œéœ€è¦ä¿ç•™å•ä¸ªæ¨¡å—çš„å¯ç»´æŠ¤æ€§ï¼Œå…¶æ¬¡æ˜¯ä¸ºäº†è§£å†³éƒ¨åˆ†ä½ç‰ˆæœ¬æµè§ˆå™¨ä¸æ”¯æŒes6è¯­æ³•ï¼Œéœ€è¦è½¬æ¢ä¸ºes5è¯­æ³•ï¼Œä¸ºæµè§ˆå™¨ä½¿ç”¨ï¼Œè¯¥é¡¹ç›®é‡‡ç”¨webpackä½œä¸ºå‰ç«¯æ‰“åŒ…å·¥å…·

#### 2.1 webpacké…ç½®æ–‡ä»¶
```
// webpack.pro.config.js
const webpack = require('webpack');
const path = require('path');

const {name} = require('../package.json');

const rootPath = path.resolve(__dirname, '../');

module.exports = {
  mode: 'production',
  entry: {
    kdutil: path.resolve(rootPath, 'src/index.js'),
  },
  output: {
    filename: `[name].min.js`,
    path: path.resolve(rootPath, 'dist'),
    library: `${name}`,
    libraryTarget: "umd"
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        loader: "babel-loader",
        exclude: /node_modules/
      },
    ]
  },
  plugins: [
    new webpack.optimize.ModuleConcatenationPlugin()  
    # å¯ç”¨ä½œç”¨åŸŸæå‡ï¼Œä½œç”¨æ˜¯è®©ä»£ç æ–‡ä»¶æ›´å°ã€è¿è¡Œçš„æ›´å¿«
  ]
};

```
é…ç½®è§£æï¼š
- entryï¼šæ‰“åŒ…çš„å…¥å£æ–‡ä»¶å®šä¹‰
- pluginsï¼šé€šè¿‡æ’ä»¶å¼•å…¥æ¥å¤„ç†ï¼Œç”¨äºè½¬æ¢æŸç§ç±»å‹çš„æ¨¡å—ï¼Œå¯ä»¥å¤„ç†ï¼šæ‰“åŒ…ã€å‹ç¼©ã€é‡æ–°å®šä¹‰å˜é‡ç­‰
- loader - å¤„ç†æµè§ˆå™¨ä¸èƒ½ç›´æ¥è¿è¡Œçš„è¯­è¨€,å¯ä»¥å°†æ‰€æœ‰ç±»å‹çš„æ–‡ä»¶è½¬æ¢ä¸º webpack èƒ½å¤Ÿå¤„ç†çš„æœ‰æ•ˆæ¨¡å— (å¦‚ä¸Šå›¾ babel-loader ç”¨äºè½¬æ¢æµè§ˆå™¨å› ä¸å…¼å®¹es6å†™æ³•çš„è½¬æ¢
å¸¸è§loaderè¿˜æœ‰TypeScriptã€Sassã€Lessã€Stylusç­‰)
- output ï¼šè¾“å…¥æ–‡ä»¶é…ç½®ï¼ŒpathæŒ‡çš„æ˜¯è¾“å‡ºè·¯å¾„ï¼Œfileæ˜¯æŒ‡æœ€ç»ˆè¾“å‡ºçš„æ–‡ä»¶åç§°ï¼Œæœ€å…³é”®çš„æ˜¯libraryTargetå’Œlibraryï¼Œè¯·çœ‹ä¸‹ä¸€ç« 

#### 2.1 webpack å…³äºå¼€å‘ç±»åº“ä¸­libraryTargetå’Œlibraryå±æ€§

> å› ä¸ºåœ¨ä¸€èˆ¬SPAé¡¹ç›®ä¸­ï¼Œä½¿ç”¨webpackæ— éœ€å…³æ³¨è¿™ä¸¤ä¸ªå±æ€§ï¼Œä½†æ˜¯å¦‚æœæ˜¯å¼€å‘ç±»åº“ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå±æ€§å°±æ˜¯å¿…é¡»äº†è§£çš„ã€‚

libraryTarget æœ‰ä¸»è¦å‡ ç§å¸¸è§çš„å½¢å¼ğŸ‘‡ï¼š

- libraryTarget: â€œvarâ€ï¼ˆdefaultï¼‰: libraryä¼šå°†å€¼ä½œä¸ºå˜é‡å£°æ˜å¯¼å‡ºï¼ˆå½“ä½¿ç”¨ script æ ‡ç­¾æ—¶ï¼Œå…¶æ‰§è¡Œåå°†åœ¨å…¨å±€ä½œç”¨åŸŸå¯ç”¨ï¼‰

- libraryTarget: â€œwindowâ€ : å½“ library åŠ è½½å®Œæˆï¼Œè¿”å›å€¼å°†åˆ†é…ç»™ window å¯¹è±¡ã€‚

- libraryTarget: â€œcommonjsâ€ : å½“ library åŠ è½½å®Œæˆï¼Œè¿”å›å€¼å°†åˆ†é…ç»™ exports å¯¹è±¡ï¼Œè¿™ä¸ªåç§°ä¹Ÿæ„å‘³ç€æ¨¡å—ç”¨äº CommonJS ç¯å¢ƒï¼ˆnodeç¯å¢ƒï¼‰

- libraryTarget: â€œumdâ€ ï¼šè¿™æ˜¯ä¸€ç§å¯ä»¥å°†ä½ çš„ library èƒ½å¤Ÿåœ¨æ‰€æœ‰çš„æ¨¡å—å®šä¹‰ä¸‹éƒ½å¯è¿è¡Œçš„æ–¹å¼ã€‚å®ƒå°†åœ¨ CommonJS, AMD ç¯å¢ƒä¸‹è¿è¡Œ (ç›®å‰è¯¥å·¥å…·åº“ä½¿ç”¨ğŸš€)

è€ŒlibraryæŒ‡å®šçš„æ˜¯ä½ requireæˆ–è€…importæ—¶å€™çš„æ¨¡å—å

#### 2.3 å…¶ä»–æ‰“åŒ…å·¥å…·

- Rollupï¼š [ä¼ é€é—¨ğŸšª](https://www.rollupjs.com/)


### 3.æ¨¡å—åŒ–å¼€å‘

> è¯¥å·¥å…·åº“åŒ…å«å¤šä¸ªåŠŸèƒ½æ¨¡å—ï¼Œå¦‚localstorageã€dateã€httpç­‰ç­‰ï¼Œå°±éœ€è¦å°†ä¸åŒåŠŸèƒ½æ¨¡å—åˆ†å¼€ç®¡ç†ï¼Œæœ€åä½¿ç”¨webpackè§£ærequire.context()ï¼Œ é€šè¿‡require.context() å‡½æ•°æ¥åˆ›å»ºè‡ªå·±çš„ä¸Šä¸‹æ–‡ï¼Œå¯¼å‡ºæ‰€æœ‰çš„æ¨¡å—ï¼Œä¸‹é¢æ˜¯kdutilå·¥å…·åº“åŒ…å«çš„æ‰€æœ‰æ¨¡å—ğŸ‘‡

![](https://user-gold-cdn.xitu.io/2020/4/15/1717bfe638d0ebfe?w=1192&h=644&f=png&s=55406)


![](https://user-gold-cdn.xitu.io/2020/4/15/1717c417d3c33499?w=880&h=614&f=png&s=39461)

#### 3.1 localstorage æœ¬åœ°å­˜å‚¨æ¨¡å—
> localStorageæ˜¯Html5çš„æ–°ç‰¹å¾ï¼Œç”¨æ¥ä½œä¸ºæœ¬åœ°å­˜å‚¨æ¥ä½¿ç”¨çš„ï¼Œè§£å†³äº†cookieå­˜å‚¨ç©ºé—´ä¸è¶³çš„é—®é¢˜ï¼ŒlocalStorageä¸­ä¸€èˆ¬æµè§ˆå™¨æ”¯æŒçš„æ˜¯5Må¤§å°
```
/*
  @file: localStorage æœ¬åœ°å­˜å‚¨
  @Author: tree
 */

module.exports =  {

  get: function (name) {
    if (!name) return;
    return window.localStorage.getItem(name);
  },

  set: function (name, content) {
    if (!name) return;
    if (typeof content !== 'string') {
      content = JSON.stringify(content);
    }
    window.localStorage.setItem(name, content);
  },

  delete: function (name) {
    if (!name) return;
    window.localStorage.removeItem(name);
  }

};
```
#### 3.2  date æ—¶é—´æ ¼å¼åŒ–æ¨¡å—
> æ—¥å¸¸å¼€å‘ä¸­ç»å¸¸éœ€è¦æ ¼å¼åŒ–æ—¶é—´ï¼Œæ¯”å¦‚å°†æ—¶é—´è®¾ç½®ä¸º 2019-04-03 23:32:32
```
/*
 * @file date æ ¼å¼åŒ–
 * @author:tree
 * @createBy:@2020.04.07
 */
module.exports =  {
  /**
   * æ ¼å¼åŒ–ç°åœ¨çš„å·²è¿‡æ—¶é—´
   * @param  startTime {Date}
   * @return {String}
   */
  formatPassTime: function (startTime) {
    let currentTime = Date.parse(new Date()),
      time = currentTime - startTime,
      day = parseInt(time / (1000 * 60 * 60 * 24)),
      hour = parseInt(time / (1000 * 60 * 60)),
      min = parseInt(time / (1000 * 60)),
      month = parseInt(day / 30),
      year = parseInt(month / 12);
    if (year) return year + "å¹´å‰";
    if (month) return month + "ä¸ªæœˆå‰";
    if (day) return day + "å¤©å‰";
    if (hour) return hour + "å°æ—¶å‰";
    if (min) return min + "åˆ†é’Ÿå‰";
    else return 'åˆšåˆš';
  },
  /**
   * æ ¼å¼åŒ–æ—¶é—´æˆ³
   * @param  time {number} æ—¶é—´æˆ³
   * @param  fmt {string} æ ¼å¼
   * @return {String}
   */
  formatTime: function (time, fmt = 'yyyy-mm-dd hh:mm:ss') {
    let ret;
    let date = new Date(time);
    let opt = {
      "y+": date.getFullYear().toString(),
      "M+": (date.getMonth() + 1).toString(),     //æœˆä»½
      "d+": date.getDate().toString(),     //æ—¥
      "h+": date.getHours().toString(),     //å°æ—¶
      "m+": date.getMinutes().toString(),     //åˆ†
      "s+": date.getSeconds().toString(),     //ç§’
    };
    for (let k in opt) {
      ret = new RegExp("(" + k + ")").exec(fmt);
      if (ret) {
        fmt = fmt.replace(ret[1], (ret[1].length === 1) ? (opt[k]) : (opt[k].padStart(ret[1].length, "0")))
      }
    }
    return fmt;
  }
};

```
#### 3.3 tools å¸¸ç”¨çš„å‡½æ•°ç®¡ç†æ¨¡å—

> tools æ¨¡å—åŒ…å«ä¸€äº›å¸¸ç”¨çš„å·¥å…·å‡½æ•°ï¼ŒåŒ…æ‹¬é˜²æŠ–èŠ‚æµå‡½æ•°ã€æ·±æ‹·è´ã€æ­£åˆ™ç±»å‹åˆ¤æ–­ç­‰ç­‰ï¼ŒåæœŸè¿˜ä¼šæ·»åŠ æ›´å¤šé€šç”¨çš„å·¥å…·å‡½æ•°ï¼Œæ…¢æ…¢åœ°æŠŠé¡¹ç›®åŸå…ˆä¾èµ–çš„lodashä¸€ä¸ªä¸€è‡´æ€§ã€æ¨¡å—åŒ–ã€é«˜æ€§èƒ½çš„ JavaScript å®ç”¨å·¥å…·åº“ï¼‰å»æ‰

```
/*
  @file: tools å¸¸ç”¨çš„å·¥å…·å‡½æ•°
  @Author:tree
 */

module.exports =  {
  /**
   * é€’å½’ æ·±æ‹·è´
   * @param data: æ‹·è´çš„æ•°æ®
   */
  deepCopyBy: function (data) {
    const t = getType(data);
    let o;
    if (t === 'array') {
      o = [];
    } else if (t === 'object') {
      o = {};
    } else {
      return data;
    }

    if (t === 'array') {
      for (let i = 0; i < data.length; i++) {
        o.push(deepCopy(data[i]));
      }
    } else if (t === 'object') {
      for (let i in data) {
        o[i] = deepCopy(data[i]);
      }
    }
    return o;
  },

  /**
   * JSON æ·±æ‹·è´
   * @param data: æ‹·è´çš„æ•°æ®
   * @return data Object å¤åˆ¶åç”Ÿæˆçš„å¯¹è±¡
   */
  deepCopy: function (data) {
    return JSON.parse(JSON.stringify(data));
  },

  /**
   * æ ¹æ®ç±»å‹è¿”å›æ­£åˆ™
   * @param str{string}: æ£€æµ‹çš„å†…å®¹
   * @param type{string}: æ£€æµ‹ç±»å‹
   */
  checkType: function (str, type) {
    const regexp = {
      'ip': /((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})(\.((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})){3}/.test(str),
      'port': /^(\d|[1-5]\d{4}|6[1-4]\d{3}|65[1-4]\d{2}|655[1-2]\d|6553[1-5])$/.test(str),
      'phone': /^1[3|4|5|6|7|8][0-9]{9}$/.test(str), //æ‰‹æœºå·
      'number': /^[0-9]+$/.test(str), //æ˜¯å¦å…¨æ•°å­—,
      'email': /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(str),
      'IDCard': /^(^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$)|(^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[Xx])$)$/.test(str),
      'url': /[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/i.test(str)
    };
    return regexp[type];
  },


  /**
   * å°†æ‰‹æœºå·ä¸­é—´éƒ¨åˆ†æ›¿æ¢ä¸ºæ˜Ÿå·
   * @param phone{string}: æ‰‹æœºå·ç 
   */
  formatPhone: function (phone) {
    return phone.replace(/(\d{3})\d{4}(\d{4})/, "$1****$2");
  },


  /**
   * é˜²æŠ–
   * @param func {*}  æ‰§è¡Œå‡½æ•°
   * @param wait {*}  èŠ‚æµæ—¶é—´,æ¯«ç§’
   */
  debounce: (func, wait) => {
    let timeout;
    return function () {
      let context = this;
      let args = arguments;

      if (timeout) clearTimeout(timeout);

      timeout = setTimeout(() => {
        func.apply(context, args)
      }, wait);
    }
  },

  /**
   * èŠ‚æµ
   * @param func {*}  æ‰§è¡Œå‡½æ•°
   * @param wait {*}  èŠ‚æµæ—¶é—´,æ¯«ç§’
   */
  throttle: (func, wait) => {
    let previous = 0;
    return function () {
      let now = Date.now();
      let context = this;
      if (now - previous > wait) {
        func.apply(context, arguments);
        previous = now;
      }
    }
  },

};

// ç±»å‹æ£€æµ‹
function getType(obj) {
  return Object.prototype.toString.call(obj).slice(8, -1);
}

```

#### 3.4 http æ¨¡å—
> http æ¨¡å—æœ¬è´¨æ˜¯åŸºäºaxiosåšçš„äºŒæ¬¡å°è£…ï¼Œæ·»åŠ æ‹¦æˆªå™¨ï¼Œé€šè¿‡æ‹¦æˆªå™¨ç»Ÿä¸€å¤„ç†æ‰€æœ‰httpè¯·æ±‚å’Œå“åº”ã€‚é…ç½®http request inteceptorï¼Œç»Ÿä¸€é…ç½®è¯·æ±‚å¤´ï¼Œæ¯”å¦‚tokenï¼Œå†é€šè¿‡é…ç½®http response inteceptorï¼Œå½“æ¥å£è¿”å›çŠ¶æ€ç 401 Unauthorizedï¼ˆæœªæˆæƒï¼‰ï¼Œè®©ç”¨æˆ·å›åˆ°ç™»å½•é¡µé¢ã€‚

```
/*
  @file: http è¯·æ±‚åº“
  @Author: tree
 */

import axios from 'axios';
import httpCode from '../../consts/httpCode';
import localStorage from '../localStorage'

const _axios = axios.create({});
_axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';
_axios.interceptors.request.use(
  (config) => {
    if (localStorage.get('token')) {
      config.headers.token = localStorage.get('token');
    }
    return config;
  },
  (err) => Promise.reject(err),
);

_axios.interceptors.response.use(
  (response) => {
    return response;
  }, (error) => {
    if (error && error.response) {
      if (error.response.status === 401) {
        //todo 
      }
    }
    return Promise.reject(error.response && error.response.data);
  },
);

const request = function (url, params, config, method) {
  return _axios[method](url, params, Object.assign({}, config))
    .then(checkStatus).then(checkCode);
};

// å¤„ç†ç½‘ç»œè¯·æ±‚å¸¦æ¥çš„æ ¡éªŒ
function checkStatus(response) {
  // å¦‚æœ http çŠ¶æ€ç æ­£å¸¸, åˆ™ç›´æ¥è¿”å›æ•°æ®
  if (response && (response.status === 200 || response.status === 304 || response.status === 400)) {
    return response.data || httpCode.NET_ERROR
  }
  return httpCode.NET_ERROR
}

// æ ¡éªŒæœåŠ¡å™¨è¿”å›æ•°æ®
function checkCode(res) {
  return res;
}

export default {

  init: function (option = {withCredentials: true}) {
    _axios.defaults.baseURL = option.url;
    _axios.defaults.timeout = option.timeout || 20000;
    _axios.defaults.withCredentials = option.withCredentials;
  },

  get: (url, params, config = {}) => request(url, params, config, 'get'),

  post: (url, params, config = {}) => request(url, params, config, 'post'),

}

```

 #### 3.5 sentry ç›‘æ§æ¨¡å—
 > sentryæ˜¯å¼€æºçš„å‰ç«¯å¼‚å¸¸ç›‘æ§ä¸ŠæŠ¥å·¥å…·ï¼Œé€šè¿‡é›†æˆåˆ°é¡¹ç›®ä¸­ï¼Œä½ å¯ä»¥åœ¨ä¸åŒç¯å¢ƒï¼ˆæµ‹è¯•ï¼Œç”Ÿäº§ç­‰ï¼‰ä¸­ï¼Œå¸®ä½ æ”¶é›†è®°å½•é—®é¢˜ï¼Œå¹¶å®šä½åˆ°é—®é¢˜æ‰€åœ¨ä»£ç ï¼Œkutil ä¹Ÿåœ¨é¡¹ç›®åšäº†sentryçš„æ”¯æŒ

```
/*
 * @file: sentry å¼‚å¸¸ä¸ŠæŠ¥æ—¥å¿—ç›‘æ§
 * @Author:tree,
 * å¸¸ç”¨é…ç½® optionï¼šhttps://docs.sentry.io/clients/javascript/config/
 * 1.è‡ªåŠ¨æ•è·vueç»„ä»¶å†…å¼‚å¸¸
 * 2.è‡ªåŠ¨æ•è·promiseå†…çš„å¼‚å¸¸
 * 3.è‡ªåŠ¨æ•è·æ²¡æœ‰è¢«catchçš„è¿è¡Œå¼‚å¸¸
 */

import Raven from 'raven-js';
import RavenVue from 'raven-js/plugins/vue';

class Report {
  constructor(Vue, options = {}) {
    this.vue = Vue;
    this.options = options;
  }

  static getInstance(Vue, Option) {
    if (!(this.instance instanceof this)) {
      this.instance = new this(Vue, Option);
      this.instance.install();
    }
    return this.instance;
  }

  install() {
    if (process.env.NODE_ENV !== 'development') {
      Raven.config(this.options.dsn, {
        environment: process.env.NODE_ENV,
      }).addPlugin(RavenVue, this.Vue).install();
      // ravenå†…ç½®äº†vueæ’ä»¶ï¼Œä¼šé€šè¿‡vue.config.errorHandleræ¥æ•è·vueç»„ä»¶å†…é”™è¯¯å¹¶ä¸ŠæŠ¥sentryæœåŠ¡

      // è®°å½•ç”¨æˆ·ä¿¡æ¯
      Raven.setUserContext({user: this.options.user || ''});

      // è®¾ç½®å…¨å±€tagæ ‡ç­¾
      Raven.setTagsContext({environment: this.options.env || ''});
    }
  }

  /**
   * ä¸»åŠ¨ä¸ŠæŠ¥
   * type: 'info','warning','error'
   */
  log(data = null, type = 'error', options = {}) {
    // æ·»åŠ é¢åŒ…å±‘
    Raven.captureBreadcrumb({
      message: data,
      category: 'manual message',
    });
    // å¼‚å¸¸ä¸ŠæŠ¥
    if (data instanceof Error) {
      Raven.captureException(data, {
        level: type,
        logger: 'manual exception',
        tags: {options},
      });
    } else {
      Raven.captureException('error', {
        level: type,
        logger: 'manual data',
        extra: {
          data,
          options: this.options,
          date: new Date(),
        },
      });
    }
  }
}

export default Report;

```
#### 3.6 require.context() è‡ªåŠ¨å¼•å…¥æºæ–‡ä»¶
> å½“æ‰€æœ‰æ¨¡å—å¼€å‘å®Œæˆä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å°†å„æ¨¡å—å¯¼å‡ºï¼Œè¿™é‡Œç”¨åˆ°äº†require.contextéå†æ–‡ä»¶å¤¹ä¸­çš„æŒ‡å®šæ–‡ä»¶,ç„¶åè‡ªåŠ¨å¯¼å…¥,è€Œä¸ç”¨æ¯ä¸ªæ¨¡å—å•ç‹¬å»å¯¼å…¥

```
// src/index.js
/*
*  @author:tree
*/

let utils = {};
let haveDefault = ['http','sentry'];

const modules = require.context('./modules/', true, /.js$/);

modules.keys().forEach(modulesKey => {
  let attr = modulesKey.replace('./', '').replace('.js', '').replace('/index', '');
  if (haveDefault.includes(attr)) {
    utils[attr] = modules(modulesKey).default;
  }else {
    utils[attr] = modules(modulesKey);
  }
});

module.exports = utils;


```
> å…³äº require.contextçš„ä½¿ç”¨ï¼Œrequire.context() å®ƒå…è®¸ä¼ å…¥ä¸€ä¸ªç›®å½•è¿›è¡Œæœç´¢ï¼Œä¸€ä¸ªæ ‡å¿—è¡¨ç¤ºæ˜¯å¦ä¹Ÿåº”è¯¥æœç´¢å­ç›®å½•ï¼Œä»¥åŠä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…æ–‡ä»¶,å½“ä½ æ„å»ºé¡¹ç›®æ—¶ï¼Œwebpackä¼šå¤„ç†require.contextçš„å†…å®¹

require.context()å¯ä¼ å…¥ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ï¼š

- directory ï¼šè¯»å–æ–‡ä»¶çš„è·¯å¾„
- useSubdirectories ï¼šæ˜¯å¦éå†æ–‡ä»¶çš„å­ç›®å½•
- regExpï¼š åŒ¹é…æ–‡ä»¶çš„æ­£åˆ™

### 4.å•å…ƒæµ‹è¯•

> å®Œæˆå·¥å…·åº“æ¨¡å—åŒ–å¼€å‘ä¹‹åï¼Œä¸ºäº†ä¿è¯ä»£ç çš„è´¨é‡ï¼ŒéªŒè¯å„æ¨¡å—åŠŸèƒ½å®Œæ•´æ€§ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å„æ¨¡å—è¿›è¡Œæµ‹è¯•åï¼Œç¡®ä¿åŠŸèƒ½æ­£å¸¸ä½¿ç”¨ï¼Œå†è¿›è¡Œå‘å¸ƒ

æˆ‘åœ¨å·¥å…·åº“å¼€å‘ä½¿ç”¨jestä½œä¸ºå•å…ƒæµ‹è¯•æ¡†æ¶ï¼ŒJest æ˜¯ Facebook å¼€æºçš„ä¸€æ¬¾ JS å•å…ƒæµ‹è¯•æ¡†æ¶ï¼ŒJest é™¤äº†åŸºæœ¬çš„æ–­è¨€å’Œ Mock åŠŸèƒ½å¤–ï¼Œè¿˜æœ‰å¿«ç…§æµ‹è¯•ã€è¦†ç›–åº¦æŠ¥å‘Šç­‰å®ç”¨åŠŸèƒ½
ï¼Œå…³äºæ›´å¤šå•å…ƒæµ‹è¯•çš„å­¦ä¹ å‰å¾€ã€Šå‰ç«¯å•å…ƒæµ‹è¯•é‚£äº›äº‹ã€‹ [ä¼ é€é—¨ğŸšª](https://juejin.im/post/5e2405146fb9a02fea37366c)

ä¸‹é¢æˆ‘é‚£dateæ¨¡å—æ¥ä½œä¸ºä¸€ä¸ªæ¡ˆä¾‹ï¼Œæ˜¯å¦‚ä½•å¯¹è¯¥æ¨¡å—è¿›è¡Œæµ‹è¯•çš„

#### 4.1 jest é…ç½®æ–‡ä»¶
```
// jest.config.js
const path = require('path');

module.exports = {
  verbose: true,
  rootDir: path.resolve(__dirname, '../../'),
  moduleFileExtensions: [
    'js',
    'json',
  ],
  testMatch: [ // åŒ¹é…æµ‹è¯•ç”¨ä¾‹çš„æ–‡ä»¶
    '<rootDir>/test/unit/specs/*.test.js',
  ],
  transformIgnorePatterns: ['/node_modules/'],
};
```
#### 4.2 æµ‹è¯•ç”¨ä¾‹
```
// date.test.js
const date = require('../../../src/modules/date');

describe('date æ¨¡å—', () => {
  test('formatTime()é»˜è®¤æ ¼å¼ï¼Œè¿”å›æ—¶é—´æ ¼å¼æ˜¯å¦æ­£å¸¸', () => {
    expect(date.formatTime(1586934316925)).toBe('2020-04-15 15:05:16');
  })
  test('formatTime()ä¼ å‚æ•°ï¼Œè¿”å›æ—¶é—´æ ¼å¼æ˜¯å¦æ­£å¸¸', () => {
    expect(date.formatTime(1586934316925,'yyyy.MM.dd')).toBe('2020.04.15');
  })
});
```
æ‰§è¡Œ ``` npm run test ```

![](https://user-gold-cdn.xitu.io/2020/4/15/1717cc9b99e636e0?w=1918&h=540&f=png&s=82526)



### 5.è„šæœ¬å‘½ä»¤

> å®Œæˆä¸Šé¢ä¸€ç³»åˆ—å¼€å‘åï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•å°†æ‰€æœ‰æ¨¡å—æ‰“åŒ…æˆå·¥å…·åº“äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±è½®åˆ°â€œè„šæœ¬å‘½ä»¤â€
> è¿™ä¸ªä¸»è§’ç™»åœºäº†

é€šè¿‡åœ¨packjsonä¸­å®šä¹‰è„šæœ¬å‘½ä»¤å¦‚ä¸‹ğŸ‘‡
```
{
  "scripts": {
    "build_rollup": "rollup -c",
    "build": "webpack --config ./build/webpack.pro.config.js"
    "test": "jest --config src/test/unit/jest.conf.js",
  },
  ...
}
```
é…ç½®å®Œåï¼Œæ‰§è¡Œ ```npm run build```


![](https://user-gold-cdn.xitu.io/2020/4/15/1717c5de15a273a1?w=1260&h=994&f=png&s=196730)
æ‰§è¡Œå®Œæˆï¼Œdistç›®å½•å°†ä¼šå‡ºç°ç”Ÿæˆçš„ kdutil.min.js , è¿™ä¹Ÿæ˜¯å·¥å…·åº“æœ€ç»ˆä¸Šä¼ åˆ°npmçš„â€œå…¥å£æ–‡ä»¶â€œ

### 6.npm å‘å¸ƒ

>  å®Œæˆä¸Šè¿°è„šæœ¬å‘½ä»¤çš„è®¾ç½®ï¼Œç°åœ¨è½®åˆ°æœ€åçš„ä¸€æ­¥å°±æ˜¯â€œå‘åŒ…â€ï¼Œä½¿ç”¨npmæ¥è¿›è¡ŒåŒ…ç®¡ç†

#### 6.1 é€šè¿‡packjsoné…ç½®ä½ çš„åŒ…ç›¸å…³ä¿¡æ¯
```
//package.json
{
  "name": "kdutil",
  "version": "0.0.2",  # åŒ…çš„ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å‘å¸ƒä¸èƒ½é‡å¤
  "main": "dist/kdutil.min.js", # æ‰“åŒ…å®Œçš„ç›®æ ‡æ–‡ä»¶
  "author": "tree <shuxin_liu@kingdee.com>",
  "keywords": [
    "utils",
    "tool",
    "kdutil"
  ],
  ... 
}
```
#### 6.2 ç¼–å†™å¼€å‘æ–‡æ¡£readme.me


![](https://user-gold-cdn.xitu.io/2020/4/15/1717c724fbf84ab2?w=1988&h=1466&f=png&s=158328)
#### 6.3 å‘å¸ƒ

é¦–å…ˆéœ€è¦å…ˆç™»å½•ä½ çš„npmè´¦å·ï¼Œç„¶åæ‰§è¡Œå‘å¸ƒå‘½ä»¤

```
npm login # ç™»å½•ä½ ä¸Šé¢æ³¨å†Œçš„npmè´¦å·

npm publish # ç™»å½•æˆåŠŸåï¼Œæ‰§è¡Œå‘å¸ƒå‘½ä»¤

+ kdutil@0.0.2 # å‘å¸ƒæˆåŠŸæ˜¾ç¤ºnpmæŠ¥ååŠåŒ…çš„ç‰ˆæœ¬å·
```


### 7.ç»“å°¾

> é€šè¿‡ä¸Šæ–‡æ‰€è¿°ï¼Œæˆ‘ä»¬å°±ä»0åˆ°1å®Œæˆæ¥ä¸€ä¸ªç®€æ˜“ç‰ˆçš„å·¥å…·åº“kdutilï¼Œè¿™æ˜¯githubåœ°å€[https://github.com/littleTreeme/kdutilğŸš€](https://github.com/littleTreeme/kdutil)ï¼Œå¦‚æœæ„Ÿåˆ°å¯¹ä½ æœ‰å¸®åŠ©ï¼Œç»™ä¸ªstar âœ¨ï¼Œéå¸¸æ„Ÿè°¢
